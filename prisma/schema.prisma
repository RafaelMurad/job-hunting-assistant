generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String?
  location  String

  // CV content stored as text
  summary    String   // Professional summary
  experience String   // Formatted text of work experience
  skills     String   // Comma-separated skills

  // CV file storage (Vercel Blob)
  cvPdfUrl     String?   // URL to original/compiled PDF in Blob
  cvLatexUrl   String?   // URL to LaTeX source in Blob
  cvFilename   String?   // Original filename for display
  cvUploadedAt DateTime? // When CV was last uploaded/updated

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  applications Application[]
}

model Application {
  id             String   @id @default(cuid())
  userId         String

  // Job details
  company        String
  role           String
  jobDescription String   // Full job description
  jobUrl         String?

  // Analysis results
  matchScore     Int      // 0-100
  analysis       String   // Claude's analysis
  coverLetter    String   // Generated cover letter

  // Tracking
  status         String   @default("saved")  // saved, applied, interviewing, rejected, offer
  appliedAt      DateTime?
  notes          String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, createdAt])
}
